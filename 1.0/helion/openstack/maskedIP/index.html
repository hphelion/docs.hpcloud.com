<!doctype html>
<!--[if lt IE 7]> <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if IE 9]>    <html class="no-js ie9" lang="en"> <![endif]-->
<!--[if gt IE 9]><!--> <html class="no-js" lang="en"> <!--<![endif]-->

<!-- Mirrored from docs.hpcloud.com/helion/openstack/maskedIP/ by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 20 Feb 2015 14:58:26 GMT -->
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

	<title>HP Helion OpenStack&#174; Tracking masked IP addresses</title>
	
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link rel="shortcut icon" href="../../../favicon.ico" type="image/vnd.microsoft.icon" />
  <link rel="stylesheet" href="../../../css/combined.css">

	<script src="../../../js/modernizr-2.5.3.min.js"></script>
	<script src="../../../js/metrics.js"></script> 
</head>
<body>
  <div id="wrapper">
    <!--[if lt IE 7]>
    	<p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
    <![endif]-->
    <div class="header-container">
      <header class="header">
      	<div class="top-bar" style="height: 75px;">
		
      		<div class="search-wrapper wrapper container_16">
			
      			<a href="#" class="sales-rep show-320 show-480 hide-768"><span aria-hidden="true" class="icon-icon-sales-rep"></span></a>
      			<nav class="sub-nav" >
				<a href="../../../index.html" class="logo"  ><img src="../../../images/HP_Helion_logo_72.png" style="position: absolute;top: 10px;" alt="HP Helion" /></a>
        			<ul>
					
 

         
        				<li><a href="../../../../external.html?link=http://www8.hp.com/us/en/cloud/helion-portfolio.html">Helion@HP</a></li>
						<li><a href="../../../../external.html?link=https://h30580.www3.hp.com/">Support</a></li>
        				<li><a href="mailto:heliondocs@hp.com">Contact</a></li>
						
        				 
        			</ul>
      			</nav>
          </div>
      	</div>
		<!-- per JC
      	<div class="nav-wrapper wrapper container_16">
        	<a href="http://www.hpcloud.com/" class="logo"><img src="/images/HP_Helion_logo_72.png" alt="HP Helion" /></a>
      		<nav class="nav hide-320 show-768">
      			<ul>
      				<li><a href="http://hpcloud.com/products-services">Products <span>& Services</span></a></li>
      				<li><a href="http://hpcloud.com/solutions">Cloud <span>Solutions</span></a></li>
      				<li><a href="http://hpcloud.com/why-hp-cloud">Why HP <span>Cloud?</span></a></li>
      				<li><a href="http://hpcloud.com/learning-center">Learning <span>Center</span></a></li>
      				<li><a href="http://hpcloud.com/blog">The <span>Blog</span></a></li>
      				<li><a href="http://hpcloud.com/free-trial">Sign Up <span>Today</span></a></li>
      			</ul>
      		</nav>
      	</div>
		-->
      </header>
    </div>
		<div id="main-container">
			<div id="main" class="wrapper clearfix container_16">
				<div id="content" class="grid_10 suffix_1">
	<article>
		<!--PUBLISHED-->

<script>
<![CDATA[

function PageRefresh {
onLoad="window.refresh"
}

PageRefresh();

]]>
</script><h1 id="hp-helion-openstack-tracking-masked-ip-addresses-when-using-network-address-translation-nat">HP Helion OpenStack®: Tracking masked IP addresses when using network address translation (NAT)</h1>

<p>Network Address Translation (NAT) is used to mask an originating IP address. As a result, you may receive notification of abuse that appears to originate from an IP address which is part of your own IP address range.</p>

<p>You can identify the source IP address by using one of the following methods. These methods allow lookup of the Nova VM associated with the masked IP address.</p>

<h2 id="method-1">Method 1</h2>

<ol><li><p>Log in to the HP Helion OpenStack Commercial dashboard as cloud admin.</p></li>
<li><p>Select the project you want to work with.</p></li>
<li><p>Click the <strong>Access &amp; Security</strong> link on the <strong>Project</strong> dashboard <strong>Compute</strong> panel.</p></li>
<li><p>The <strong>Access &amp; Security</strong> page is displayed with four tabs, <strong>Security Groups</strong>, <strong>Key Pairs</strong>, <strong>Floating IPs</strong>, and <strong>API Access</strong>.</p></li>
<li><p>Click the <strong>Floating IPs</strong> tab.</p></li>
<li><p>In the list of floating IPs, locate the IP where the malicious activity originated from and note the instance that this IP is assigned to.</p></li>
<li><p>Click the name of the instance in the list.  The <strong>Instance Details</strong> page displays. Using this information, you can now see all the details of the compromised instance. You may choose to shut it down, contact the instance owner to investigate further, or both.</p></li>
</ol><h2 id="method-2">Method 2</h2>

<ol><li><p>Log in to the Controller node</p></li>
<li><p>For each tenant, run the command:   (Using 16.103.148.249 as an example IP address)</p>

<pre><code>neutron floatingip-list | grep "16.103.148.249" 
</code></pre>

<p>which produces output similar to the following:</p>

<pre><code>| dc56c9ce-b126-4553-85f4-9a92fd7e8c43 | 192.168.4.4      | 16.103.148.249      | 262e4206-9713-4088-a6e9-928de30afa82 |
</code></pre></li>
<li><p>Capture the <strong>fixed-IP</strong> (in the second column) (eg.. 192.168.4.4) and <strong>tenant id</strong>.</p></li>
<li><p>Log in to the Compute node.</p></li>
<li><p>Run <strong><em>nova list</em></strong> for the captured tenant id and fixed-ip address using the command:</p>

<pre><code>nova --os-tenant-id=&lt;tenant-id&gt; list | grep "192.168.4.4"
</code></pre>

<p>Producing output similar to the following:</p>

<pre><code>| 47c06647-375e-4bd6-8714-d6841840bd56 | test1 | ACTIVE | None       | Running     | n1=192.168.4.4, 16.103.148.249 |
</code></pre></li>
<li><p>Capture the nova id and get the details of the VM using the command:</p>

<pre><code>nova  --os-tenant-id=&lt;tenant-id&gt; show 47c06647-375e-4bd6-8714-d6841840bd56
</code></pre></li>
</ol><p>Which produces output similar to the following:</p>

<pre>
  <code>    +--------------------------------------+-------------------------------+
    | Property                             | Value                         |
    +--------------------------------------+-------------------------------+
    | status                               | ACTIVE                        |
    | updated                              | 2014-06-26T01:41:05Z          |
    | OS-EXT-STS:task_state                | None                          |
    | OS-EXT-SRV-ATTR:host                 | icehousecompute               |
    | key_name                             | None                          |
    | image                                | tty-linux (503cd8f1-ae6c ...)   |
    | hostId                               | 091ce2ae798d669b1ec9cc53 ...    |
    | OS-EXT-STS:vm_state                  | active                        |
    | OS-EXT-SRV-ATTR:instance_name        | instance-0000000f             |
    | OS-SRV-USG:launched_at               | 2014-06-26T01:41:22.000000    |
    | OS-EXT-SRV-ATTR:hypervisor_hostname  | icehousecompute.example.com   |
    | flavor                               | m1.tiny (1)                   |
    | id                                   | 47c06647-375e-4bd6-8714 ...     |
    | security_groups                      | [{u'name': u'default'}]       |
    | OS-SRV-USG:terminated_at             | None                          |
    | user_id                              | e888a6ffca9249bf810f73 ...      |
    | name                                 | test1                         |
    | created                              | 2014-06-26T01:40:59Z          |
    | tenant_id                            | 408806a339b340e88d1b1 ...       |
      (etc)
    | n1 network                           | 192.168.4.4, 16.103.148.249   |
    | config_drive                         |                               |
    +--------------------------------------+-------------------------------+
</code>
</pre>

<p>Using this information, you can now see all the details of the malicious instance.  You may choose to shut it down, contact the instance owner to investigate further, or both.</p>

<h2 id="method-3">Method 3</h2>

<ol><li><p>Log in to the Controller node</p></li>
<li><p>Run the command:</p>

<pre><code>ip netns | grep "qrouter"
</code></pre>

<p>Which produces output similar to the following:</p>

<pre><code>qrouter-0fa45f02-6e89-4707-89f3-0f7c31cf03bf
</code></pre></li>
<li><p>Assuming 16.103.148.249 is the malicious IP address: for each <strong><em>qrouter</em></strong>, run the command:</p>

<pre><code>ip netns exec qrouter-0fa45f02-6e89-4707-89f3-0f7c31cf03bf iptables -L -v -t nat | grep &amp;ldquo;16.103.148.249&amp;rdquo;
</code></pre>

<p>Producing output similar to the following:</p>

<pre><code>0 0 DNAT  all -- any  any anywhere     16.103.148.249  to:192.168.4.2
0 0 DNAT  all -- any  any anywhere     16.103.148.24   to:192.168.4.2
0 0 SNAT  all -- any  any 192.168.4.2  anywhere        to:16.103.148.249
</code></pre></li>
<li><p>If the command returns any results, capture the fixed IP address, which is 192.168.4.2 in the above example (Look in the "to: " field of DNAT rows)</p></li>
<li><p>Log in to the Nova controller node</p></li>
<li><p>For each tenant/project, run the following command to search on fixed IP and floating IP:</p>

<pre><code>nova list | grep "192.168.4.2" | grep "16.103.148.249"
</code></pre>

<p>Producing output similar to the following:</p>

<pre><code>| 2edf0570-8ed7-4cc4-a836-f4095d64534e | test2 | ACTIVE | None       | Running     | n1=192.168.4.2, 16.103.148.249 |
</code></pre></li>
<li><p>Get the details of the above instance using the command:</p>

<pre><code>nova show 2edf0570-8ed7-4cc4-a836-f4095d64534e
</code></pre>

<p>Which produces output similar to the output in Step 6 of Method 2.</p>

<p>Using this information, you can now see all the details of the malicious instance.  You may choose to shut it down, contact the instance owner to investigate further.  or both.</p>

<p><a href="#top" style="padding:14px 0px 14px 0px; text-decoration: none;"> Return to Top ↑ </a></p></li>
</ol><hr />
	</article>
</div>

<div id="sidebar" class="grid_5 top-spacer">
	<aside class="signup-box">
		<p class="align-center">
			Start using HP Cloud<br>
			<a href="../../../../external.html?link=https://helion.hpwsportal.com/#/Home/Show" class="signup-button-orange gutter-top-half">Sign Up Now</a>
		</p>
	</aside>
	<aside class="box section-navigation">
  
     
  
  <ul>
    
      
      
      <li>
        <a class="" href="../../../index.html"><span>HP Helion Documentation</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../index.html"><span>HP Helion OpenStack Documentation Home</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../release-notes/101/index.html"><span>Release Notes</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../faq/index.html"><span>FAQ</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../technical-overview/index.html"><span>Technical Overview</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../services/overview/index.html"><span>Services Overview</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../support-matrix/index.html"><span>Support Matrix</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../install/overview/index.html"><span>Installation Overview</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../install/security/index.html"><span>Network Security</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../backup.restore/index.html"><span>Back Up and Restore</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../services/troubleshooting/index.html"><span>Troubleshooting</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../related-links/index.html"><span>Related Documentation</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../glossary/index.html"><span>Glossary</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../eula/index.html"><span>End User License Agreement</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../3rd-party-license-agreements/index.html"><span>Open Source and Third-Party Software License Agreements</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../siteindex/index.html"><span>Site Index</span></a>
      </li>
    
  </ul>
</aside>
</div>

			</div> <!-- #main -->
		</div> <!-- #main-container -->
	</div> <!-- #wrapper -->

		
  <footer class="footer">
    <div class="container_16">
    	<div class="wrapper grid_16">
    		<ul class="footer-social">
    			<li class="twitter"><a href="../../../../external.html?link=https://twitter.com/hphelioncloud"></a></li>
    			<li class="youtube"><a href="../../../../external.html?link=http://www.youtube.com/hpcloud"></a></li>
    			<li class="rss"><a href="../../../../external.html?link=http://h30499.www3.hp.com/hpeb/rss/board?board.id=sws-661"></a></li>
    			<li class="facebook"><a href="../../../../external.html?link=https://www.facebook.com/HPCloud"></a></li>
    			<li class="linkedin stretch"><a href="../../../../external.html?link=https://www.linkedin.com/company/hewlett-packard"></a></li>
    		</ul>
    		<ul class="contact-info">
    			<li>In the U.S.<br />1-855-61CLOUD</li>
    			<li>Worldwide<br />+1678-745-9010</li>
    			<li class="col-3">Online Support<br /><a href="mailto:support@hpcloud.com">Email</a> 
				<!-- comment out per JC
				or <span class="link" onclick="jQuery('#hpcloud-chat-button a').click();">Chat with us</span>
				-->
				</li>
    		</ul>
    		<div class="copyright">
    			<p>The OpenStack&reg; Word Mark and OpenStack Logo are either registered trademarks/service marks or trademarks/service marks of the OpenStack Foundation, in the United States and other countries and are used with the OpenStack Foundation's permission. We are not affiliated with, endorsed or sponsored by the OpenStack Foundation, or the OpenStack community.</p><br />
    			<p>&copy; 2014 Hewlett-Packard Development Company, L.P.<br /><a href="../../../../external.html?link=http://www.hpcloud.com/legal-documents">HP Cloud legal documents and privacy policy</a></p>
    		</div>
    	</div>
    </div>
  </footer>

	<script src="../../../../ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <script src="../../../../ajax.googleapis.com/ajax/libs/jqueryui/1.10.2/jquery-ui.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../../js/jquery-1.8.2f.min.html"><\/script>')</script>

  <script src="../../../js/combined.js"></script>
  <script>
      __HP_CHAT_CONF = {};
      __HP_CHAT_CONF.sales = true;
      __HP_CHAT_CONF.support = true;
    </script>
	
    <script> //removed per JC
    //(function($, window) {
    //    $(window).load(function() {
    //    var sNew = document.createElement("script");
    //  sNew.async = true;
    //sNew.src = 'https://a248.e.akamai.net/cdn.hpcloudsvc.com/gcbb18d905d32174e6eb205943b0dea4a/prodae1/chat.js';
    //var s0 = document.getElementsByTagName('script')[0];
    //s0.parentNode.insertBefore(sNew, s0);
    //});
    //})(jQuery, this);
    </script>
    <script>
        //Executes your code when the DOM is ready.  Acts the same as $(document).ready().
        function styleRestCmds() {
            $("h5:contains('GET')").addClass('rest_cmd cmd_get');
            $("h5:contains('POST')").addClass('rest_cmd cmd_post');
            $("h5:contains('FormPOST')").removeClass('rest_cmd cmd_post');
            $("h5:contains('PUT')").addClass('rest_cmd cmd_put');
            $("h5:contains('COPY')").addClass('rest_cmd cmd_copy');
            $("h5:contains('PATCH')").addClass('rest_cmd cmd_patch');
            $("h5:contains('HEAD')").addClass('rest_cmd cmd_head');
            $("h5:contains('DELETE')").addClass('rest_cmd cmd_delete');
        }

        $(function() {
            //Calls the tocify method on your HTML div.
            $("#toc").tocify({
                'selectors': 'h2,h3,h4',
                'showAndHideOnScroll': false,
                'hideEffect': 'slideUp',
                'scrollTo': 55    // Amount of space between top of page and selected content
              }
            );
            // Style the REST commands
            styleRestCmds();
        });
    </script>
</body>

<!-- Mirrored from docs.hpcloud.com/helion/openstack/maskedIP/ by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 20 Feb 2015 14:58:26 GMT -->
</html>

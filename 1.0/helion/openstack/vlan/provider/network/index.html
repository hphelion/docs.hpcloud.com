<!doctype html>
<!--[if lt IE 7]> <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if IE 9]>    <html class="no-js ie9" lang="en"> <![endif]-->
<!--[if gt IE 9]><!--> <html class="no-js" lang="en"> <!--<![endif]-->

<!-- Mirrored from docs.hpcloud.com/helion/openstack/vlan/provider/network/ by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 20 Feb 2015 15:04:11 GMT -->
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

	<title>HP Helion OpenStack&#174; Edition: VSA Support</title>
	
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link rel="shortcut icon" href="../../../../../favicon.ico" type="image/vnd.microsoft.icon" />
  <link rel="stylesheet" href="../../../../../css/combined.css">

	<script src="../../../../../js/modernizr-2.5.3.min.js"></script>
	<script src="../../../../../js/metrics.js"></script> 
</head>
<body>
  <div id="wrapper">
    <!--[if lt IE 7]>
    	<p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
    <![endif]-->
    <div class="header-container">
      <header class="header">
      	<div class="top-bar" style="height: 75px;">
		
      		<div class="search-wrapper wrapper container_16">
			
      			<a href="#" class="sales-rep show-320 show-480 hide-768"><span aria-hidden="true" class="icon-icon-sales-rep"></span></a>
      			<nav class="sub-nav" >
				<a href="../../../../../index.html" class="logo"  ><img src="../../../../../images/HP_Helion_logo_72.png" style="position: absolute;top: 10px;" alt="HP Helion" /></a>
        			<ul>
					
 

         
        				<li><a href="../../../../../../external.html?link=http://www8.hp.com/us/en/cloud/helion-portfolio.html">Helion@HP</a></li>
						<li><a href="../../../../../../external.html?link=https://h30580.www3.hp.com/">Support</a></li>
        				<li><a href="mailto:heliondocs@hp.com">Contact</a></li>
						
        				 
        			</ul>
      			</nav>
          </div>
      	</div>
		<!-- per JC
      	<div class="nav-wrapper wrapper container_16">
        	<a href="http://www.hpcloud.com/" class="logo"><img src="/images/HP_Helion_logo_72.png" alt="HP Helion" /></a>
      		<nav class="nav hide-320 show-768">
      			<ul>
      				<li><a href="http://hpcloud.com/products-services">Products <span>& Services</span></a></li>
      				<li><a href="http://hpcloud.com/solutions">Cloud <span>Solutions</span></a></li>
      				<li><a href="http://hpcloud.com/why-hp-cloud">Why HP <span>Cloud?</span></a></li>
      				<li><a href="http://hpcloud.com/learning-center">Learning <span>Center</span></a></li>
      				<li><a href="http://hpcloud.com/blog">The <span>Blog</span></a></li>
      				<li><a href="http://hpcloud.com/free-trial">Sign Up <span>Today</span></a></li>
      			</ul>
      		</nav>
      	</div>
		-->
      </header>
    </div>
		<div id="main-container">
			<div id="main" class="wrapper clearfix container_16">
				<div id="content" class="grid_10 suffix_1">
	<article>
		<!--PUBLISHED-->

<script>
<![CDATA[

function PageRefresh {
onLoad="window.refresh"
}

PageRefresh();

]]>
</script><!---<p style="font-size: small;"> <a href="/helion/openstack/install/kvm/">&#9664; PREV</a> | <a href="/helion/openstack/install-overview/">&#9650; UP</a> | <a href="/helion/openstack/install/esx/">NEXT &#9654;</a> </p>--><h1 id="hp-helion-openstack-10-enabling-vlan-provider-network-in-hp-helion-openstack">HP Helion OpenStack® 1.0: Enabling VLAN Provider Network in HP Helion OpenStack</h1>

<p>This page provides a detailed description to enable VLAN Provider Network in KVM Cloud Type.</p>

<!---HP Helion &#174;OpenStack can be deployed in multiple ways to fulfill certain requirements using an installer. Installers depend on Virtual Extensible Local Area Network (VxLAN) or Generic Routing Encapsulation (GRE) to isolate tenants which is an important requirement.  These two latest networking technologies have become de-facto standards for installers because they ease infrastructure readiness requirements while providing tenant isolation, independent of any hardware (Switch/Router) configuration.-->

<p>HP Helion OpenStack defaults to VxLAN to support tenant network isolation in a KVM Cloud Type. <!---However, we need to deploy Helion Cloud to customers desiring to migrate gradually from legacy VLAN to VxLAN, a non-default install feature. This whitepaper walks through a way to configure Helion OpenStack tenant networks to use VLAN Provider Network.--> The deployment of HP Helion OpenStack® enables  tenant's virtual machines hosted in a legacy infrastructure and/or based on VMWare ESX to communicate to a virtual machine running in HP Helion OpenStack. <!---Typically, a Hybrid Application Deployment across two or more Infrastructure Providers (one being Helion OpenStack).--></p>

<h2 id="deployment-diagram">Deployment Diagram</h2>

<p>The following deployment diagrams are based on the assumption that the network infrastructure is carved out in such a way that it allows a range of tagged VLANs through the switches and their subnets are routed to the right destination.</p>

<p>
  <a href="javascript:window.open('../../../../../content/documentation/media/vlan.provider.network.logical.png','_blank','toolbar=no,menubar=no,resizable=yes,scrollbars=yes')">Deployment diagram depicting VLAN Provider Network with VSA nodes as Block storage backend. (Opens in a new window)</a>
</p>

<p>
  <a href="javascript:window.open('../../../../../content/documentation/media/vlan.network.layout.png','_blank','toolbar=no,menubar=no,resizable=yes,scrollbars=yes')">Network Layout. (Opens in a new window)</a>
</p>

<h2 id="install-steps">Install Steps</h2>

<p>This section describes the solution to set up the Overcloud Neutron Network to provide tenant network isolation by means of VLAN, instead of the default VxLAN.</p>

<p>The following prerequisites should be fulfilled to setup the Overcloud Neutron in VLAN:</p>

<ol><li><p>Pass the right configuration parameters to the installer and templates for setting up the neutron configuration files:</p>

<ul><li><p><code>/etc/neutron/plugins/ml2/ml2_conf.ini</code>- sets up the tenant network type, provides the VLAN ranges and maps to the physical bridge.</p></li>
<li><p><code>/etc/neutron/dhcp-agent.ini</code>- enables Metadata Server access through DHCP Namespace.</p></li>
</ul></li>
<li><p>Pass the right export variables pertinent to the VLAN Provider Network.</p></li>
</ol><h2 id="detailed-installation-steps">Detailed installation steps</h2>

<p>The following assumptions are considered during deployment:</p>

<ul><li><p>Port 2 of all the Baremetal nodes are wired and used as bm_network - referred in the document as em2 or eth1</p></li>
<li><p>1 Untagged network for Management - subnet range 192.168.200.0/24 w/ gateway 192.168.200.1</p></li>
<li><p>90 tagged networks used for tenant VLANs as provider network</p></li>
</ul><!---* For test purpose VLAN 300 (192.168.1--><h2 id="process">Process</h2>

<ol><li><p>Login to Seed VM Host</p></li>
<li><p>Create a file <code>envfile</code> with the following export variables. Modify the IPs based on your specifications.</p>

<pre><code>export BRIDGE_INTERFACE=em2
export BM_NETWORK_SEED_IP=192.168.200.2
export BM_NETWORK_CIDR=192.168.200.0/24
export BM_NETWORK_GATEWAY=192.168.200.1
export BM_NETWORK_SEED_RANGE_START=192.168.200.3
export BM_NETWORK_SEED_RANGE_END=192.168.200.20
export BM_NETWORK_UNDERCLOUD_RANGE_START=192.168.200.31
export BM_NETWORK_UNDERCLOUD_RANGE_END=192.168.200.50
export OVERCLOUD_NeutronPublicInterface=eth1
export UNDERCLOUD_NeutronPublicInterface=eth1
export OVERCLOUD_NTP_SERVER=16.110.135.123
export UNDERCLOUD_NTP_SERVER=16.110.135.123
export FLOATING_START=192.168.200.101
export FLOATING_END=192.168.200.254
export FLOATING_CIDR=192.168.200.0/24
export OVERCLOUD_HYPERVISOR_PUBLIC_INTERFACE=eth1
export OVERCLOUD_HYPERVISOR_PHYSICAL_BRIDGE=br-ex
export OVERCLOUD_BRIDGE_MAPPINGS=physnet1:br-ex
export NeutronNetworkType=vlan
export NeutronNetworkVLANRanges=physnet1:300:398
export OVERCLOUD_CONTROL_VIRTUAL_ROUTER_ID=37
export OVERCLOUD_VIRTUAL_INTERFACE=br-ex
export OVERCLOUD_NEUTRON_DVR=False
export OVERCLOUD_COMPUTESCALE=1
#######################################
export UNDERCLOUD_CODN_HTTP_PROXY=http://16.85.88.10:8080
export UNDERCLOUD_CODN_HTTPS_PROXY=http://16.85.88.10:8080
export OVERCLOUD_CODN_HTTP_PROXY=http://16.85.88.10:8080
export OVERCLOUD_CODN_HTTPS_PROXY=http://16.85.88.10:8080
export OVERCLOUD_FIXED_RANGE_CIDR=172.0.100.0/24
</code></pre></li>
<li><p>Modify the <code>dhcp_agent.ini</code> configuration.</p>

<ul><li><p><strong>Overcloud</strong> - Edit the <code>tripleo/hp_passthrough/overcloud_neutron_dhcp_agent.json</code> file to add the parameter settings as defined in the following example and change the DNS servers specific to your environment.</p>

<pre><code>{"dhcp_agent":
  {"config":
    [
      {"section":"DEFAULT",
        "values":
          [
            {"option":"dhcp_delete_namespaces","value":"True"},
            {"option":"enable_isolated_metadata","value":"True"},
            {"option":"dnsmasq_dns_servers", "value":"10.1.0.10,10.1.0.20"}
          ]
      }
    ]
  }
}
</code></pre></li>
<li><p><strong>Undercloud</strong> - Edit the <code>tripleo/hp_passthrough/undercloud_neutron_dhcp_agent.json</code> file to add the parameter settings as defined in the following example and change the DNS servers specific to your environment.</p>

<pre><code>{"dhcp_agent":
  {"config":
    [
      {"section":"DEFAULT",
        "values":
          [
            {"option":"dhcp_delete_namespaces","value":"True"},
            {"option":"dnsmasq_dns_servers", "value":"10.1.0.10,10.1.0.20"}
          ]
      }
    ]
  }
}
</code></pre></li>
</ul></li>
<li><p>To update ml2.conf, edit <code>tripleo/hp_passthrough/overcloud_neutron_ml2_conf.json</code> and add tenant_network_type and network_vlan_ranges specific to your environment. An example is given below:</p>

<pre><code>{
   "ml2": {
        "config": [
            {
                "section": "ovs",
                "values": [
                    {
                        "option": "enable_tunneling",
                        "value": "True"
                    }
                ]
                "section": "ml2",
                "values": [
                    {
                        "option": "tenant_network_types",
                        "value": "vlan"
                    }
                ]
                "section": "ml2_type_vlan",
                "values": [ 
                    {
                        "option": "network_vlan_ranges",
                        "value": "physnet1:300:398"
                    }
                ]
            },
</code></pre></li>
<li><p>To create the Seed VM, do the following:</p>

<pre><code># source envfile
# bash -x tripleo/tripleo-incubator/scripts/hp_ced_host_manager.sh --create-seed | tee  create-seed.log
</code></pre></li>
<li><p>Copy environment file (created in step 2) to Seed and do the following from within the Seed:</p>

<pre><code># ssh into the Seed VM &lt;IP Address&gt;  
</code></pre>

<p>For example &lt;192.168.200.2&gt;</p>

<pre><code># source envfile
</code></pre></li>
<li><p>Create the baremetal.csv with the required number of nodes and specify the<br />
mac_address,ipmi_user,ipmi_password,ipmi_address,no_of_cpus,memory_MB,diskspace_GB</p>

<p>For example</p>

<pre><code>78:e7:d1:22:5d:58,administrator,password,192.168.11.1,12,32768,2048
78:e7:d1:22:52:9b,administrator,password,192.168.11.6,12,16384,900
</code></pre></li>
<li><p>To install and configure the Undercloud and Overcloud, run the following command from /root.</p>

<pre><code># bash -x tripleo/tripleo-incubator/scripts/hp_ced_installer.sh --skip-demo | tee installer.log
</code></pre></li>
</ol><h2 id="verifying-the-installation">Verifying the installation</h2>

<ol><li><p>Login to Horizon dashboard and create two projects (Tenant A and Tenant B) and also the users for the projects.</p></li>
<li><p>SSH into the controller node.</p>

<pre><code># ssh heat-admin@controller.ip
</code></pre>

<ul><li><p>Create a VLAN provider network(s) and subnets for tenant A.</p>

<pre><code># neutron net-create --provider:physical_network=physnet1 --provider:network_type=vlan --provider:segmentation_id=300 vlan300
</code></pre></li>
<li><p>Using Horizon UI, create a Subnet for the above network: <strong>192.168.100.0/24</strong>  and gateway <strong>192.168.100.1</strong></p></li>
<li><p>Create a VLAN provider network(s) and subnets for tenant B.</p>

<pre><code># neutron net-create --provider:physical_network=physnet1 --provider:network_type=vlan --provider:segmentation_id=301 vlan301
</code></pre></li>
<li><p>Using Horizon UI, create a Subnet for the network of tenant B network: Subnet: <strong>192.168.101.0/24</strong> gateway <strong>192.168.101.1</strong></p></li>
</ul></li>
<li><p>Launch two instances in vlan300 network and two in vlan301 network.</p></li>
<li><p>Validate if you can ping the VMs from the KVM Host.</p></li>
<li><p>Validate if the VMs are able to ping one another in the same network and are unable to ping other instances in the other network.</p></li>
</ol><p>
  <a href="#top" style="padding:14px 0px 14px 0px; text-decoration: none;"> Return to Top ↑ </a>
</p>

<hr />
	</article>
</div>

<div id="sidebar" class="grid_5 top-spacer">
	<aside class="signup-box">
		<p class="align-center">
			Start using HP Cloud<br>
			<a href="../../../../../../external.html?link=https://helion.hpwsportal.com/#/Home/Show" class="signup-button-orange gutter-top-half">Sign Up Now</a>
		</p>
	</aside>
	<aside class="box section-navigation">
  
     
  
  <ul>
    
      
      
      <li>
        <a class="" href="../../../../../index.html"><span>HP Helion Documentation</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../../index.html"><span>HP Helion OpenStack Documentation Home</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../../release-notes/101/index.html"><span>Release Notes</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../../faq/index.html"><span>FAQ</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../../technical-overview/index.html"><span>Technical Overview</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../../services/overview/index.html"><span>Services Overview</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../../support-matrix/index.html"><span>Support Matrix</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../../install/overview/index.html"><span>Installation Overview</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../../install/security/index.html"><span>Network Security</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../../backup.restore/index.html"><span>Back Up and Restore</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../../services/troubleshooting/index.html"><span>Troubleshooting</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../../related-links/index.html"><span>Related Documentation</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../../glossary/index.html"><span>Glossary</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../../eula/index.html"><span>End User License Agreement</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../../3rd-party-license-agreements/index.html"><span>Open Source and Third-Party Software License Agreements</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../../siteindex/index.html"><span>Site Index</span></a>
      </li>
    
  </ul>
</aside>
</div>

			</div> <!-- #main -->
		</div> <!-- #main-container -->
	</div> <!-- #wrapper -->

		
  <footer class="footer">
    <div class="container_16">
    	<div class="wrapper grid_16">
    		<ul class="footer-social">
    			<li class="twitter"><a href="../../../../../../external.html?link=https://twitter.com/hphelioncloud"></a></li>
    			<li class="youtube"><a href="../../../../../../external.html?link=http://www.youtube.com/hpcloud"></a></li>
    			<li class="rss"><a href="../../../../../../external.html?link=http://h30499.www3.hp.com/hpeb/rss/board?board.id=sws-661"></a></li>
    			<li class="facebook"><a href="../../../../../../external.html?link=https://www.facebook.com/HPCloud"></a></li>
    			<li class="linkedin stretch"><a href="../../../../../../external.html?link=https://www.linkedin.com/company/hewlett-packard"></a></li>
    		</ul>
    		<ul class="contact-info">
    			<li>In the U.S.<br />1-855-61CLOUD</li>
    			<li>Worldwide<br />+1678-745-9010</li>
    			<li class="col-3">Online Support<br /><a href="mailto:support@hpcloud.com">Email</a> 
				<!-- comment out per JC
				or <span class="link" onclick="jQuery('#hpcloud-chat-button a').click();">Chat with us</span>
				-->
				</li>
    		</ul>
    		<div class="copyright">
    			<p>The OpenStack&reg; Word Mark and OpenStack Logo are either registered trademarks/service marks or trademarks/service marks of the OpenStack Foundation, in the United States and other countries and are used with the OpenStack Foundation's permission. We are not affiliated with, endorsed or sponsored by the OpenStack Foundation, or the OpenStack community.</p><br />
    			<p>&copy; 2014 Hewlett-Packard Development Company, L.P.<br /><a href="../../../../../../external.html?link=http://www.hpcloud.com/legal-documents">HP Cloud legal documents and privacy policy</a></p>
    		</div>
    	</div>
    </div>
  </footer>

	<script src="../../../../../../ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <script src="../../../../../../ajax.googleapis.com/ajax/libs/jqueryui/1.10.2/jquery-ui.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../../../../js/jquery-1.8.2f.min.html"><\/script>')</script>

  <script src="../../../../../js/combined.js"></script>
  <script>
      __HP_CHAT_CONF = {};
      __HP_CHAT_CONF.sales = true;
      __HP_CHAT_CONF.support = true;
    </script>
	
    <script> //removed per JC
    //(function($, window) {
    //    $(window).load(function() {
    //    var sNew = document.createElement("script");
    //  sNew.async = true;
    //sNew.src = 'https://a248.e.akamai.net/cdn.hpcloudsvc.com/gcbb18d905d32174e6eb205943b0dea4a/prodae1/chat.js';
    //var s0 = document.getElementsByTagName('script')[0];
    //s0.parentNode.insertBefore(sNew, s0);
    //});
    //})(jQuery, this);
    </script>
    <script>
        //Executes your code when the DOM is ready.  Acts the same as $(document).ready().
        function styleRestCmds() {
            $("h5:contains('GET')").addClass('rest_cmd cmd_get');
            $("h5:contains('POST')").addClass('rest_cmd cmd_post');
            $("h5:contains('FormPOST')").removeClass('rest_cmd cmd_post');
            $("h5:contains('PUT')").addClass('rest_cmd cmd_put');
            $("h5:contains('COPY')").addClass('rest_cmd cmd_copy');
            $("h5:contains('PATCH')").addClass('rest_cmd cmd_patch');
            $("h5:contains('HEAD')").addClass('rest_cmd cmd_head');
            $("h5:contains('DELETE')").addClass('rest_cmd cmd_delete');
        }

        $(function() {
            //Calls the tocify method on your HTML div.
            $("#toc").tocify({
                'selectors': 'h2,h3,h4',
                'showAndHideOnScroll': false,
                'hideEffect': 'slideUp',
                'scrollTo': 55    // Amount of space between top of page and selected content
              }
            );
            // Style the REST commands
            styleRestCmds();
        });
    </script>
</body>

<!-- Mirrored from docs.hpcloud.com/helion/openstack/vlan/provider/network/ by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 20 Feb 2015 15:04:17 GMT -->
</html>

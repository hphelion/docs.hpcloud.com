<!doctype html>
<!--[if lt IE 7]> <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if IE 9]>    <html class="no-js ie9" lang="en"> <![endif]-->
<!--[if gt IE 9]><!--> <html class="no-js" lang="en"> <!--<![endif]-->

<!-- Mirrored from docs.hpcloud.com/helion/openstack/install/esx/proxy/ by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 20 Feb 2015 14:57:34 GMT -->
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

	<title>HP Helion OpenStack&#174; Edition: Deploy vCenter ESX compute proxy</title>
	
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link rel="shortcut icon" href="../../../../../favicon.ico" type="image/vnd.microsoft.icon" />
  <link rel="stylesheet" href="../../../../../css/combined.css">

	<script src="../../../../../js/modernizr-2.5.3.min.js"></script>
	<script src="../../../../../js/metrics.js"></script> 
</head>
<body>
  <div id="wrapper">
    <!--[if lt IE 7]>
    	<p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
    <![endif]-->
    <div class="header-container">
      <header class="header">
      	<div class="top-bar" style="height: 75px;">
		
      		<div class="search-wrapper wrapper container_16">
			
      			<a href="#" class="sales-rep show-320 show-480 hide-768"><span aria-hidden="true" class="icon-icon-sales-rep"></span></a>
      			<nav class="sub-nav" >
				<a href="../../../../../index.html" class="logo"  ><img src="../../../../../images/HP_Helion_logo_72.png" style="position: absolute;top: 10px;" alt="HP Helion" /></a>
        			<ul>
					
 

         
        				<li><a href="../../../../../../external.html?link=http://www8.hp.com/us/en/cloud/helion-portfolio.html">Helion@HP</a></li>
						<li><a href="../../../../../../external.html?link=https://h30580.www3.hp.com/">Support</a></li>
        				<li><a href="mailto:heliondocs@hp.com">Contact</a></li>
						
        				 
        			</ul>
      			</nav>
          </div>
      	</div>
		<!-- per JC
      	<div class="nav-wrapper wrapper container_16">
        	<a href="http://www.hpcloud.com/" class="logo"><img src="/images/HP_Helion_logo_72.png" alt="HP Helion" /></a>
      		<nav class="nav hide-320 show-768">
      			<ul>
      				<li><a href="http://hpcloud.com/products-services">Products <span>& Services</span></a></li>
      				<li><a href="http://hpcloud.com/solutions">Cloud <span>Solutions</span></a></li>
      				<li><a href="http://hpcloud.com/why-hp-cloud">Why HP <span>Cloud?</span></a></li>
      				<li><a href="http://hpcloud.com/learning-center">Learning <span>Center</span></a></li>
      				<li><a href="http://hpcloud.com/blog">The <span>Blog</span></a></li>
      				<li><a href="http://hpcloud.com/free-trial">Sign Up <span>Today</span></a></li>
      			</ul>
      		</nav>
      	</div>
		-->
      </header>
    </div>
		<div id="main-container">
			<div id="main" class="wrapper clearfix container_16">
				<div id="content" class="grid_10 suffix_1">
	<article>
		<!--PUBLISHED-->

<script>
<![CDATA[

function PageRefresh {
onLoad="window.refresh"
}

PageRefresh();

]]>
</script><!--
<p style="font-size: small;"> <a href="/helion/openstack/install/kvm/">&#9664; PREV</a> | <a href="/helion/openstack/install-overview/">&#9650; UP</a> | <a href="/helion/openstack/install/esx/">NEXT &#9654;</a> </p>
--><h1 id="hp-helion-openstack-10-deploy-vcenter-esx-compute-proxy">HP Helion OpenStackÂ® 1.0 Deploy vCenter ESX compute proxy</h1>

<p>The HP Helion OpenStack vCenter ESX compute proxy is a driver that enables the Compute service to communicate with a VMware vCenter server managing one or more ESX hosts. The HP Helion OpenStack Compute Service (Nova) requires this driver to interface with VMWare ESX hypervisor APIs.</p>

<p>The general process for deploying the vCenter ESX compute proxy involves the following:</p>

<ul><li>Verify prerequisites</li>
<li>Upload an OVA file into vCenter</li>
<li>Save the OVA as a template for the management cluster. </li>
<li>Deploy the proxy appliance.</li>
<li>Enable SSL by importing the vCenter certificate into the ESX Compute proxy.</li>
</ul><p><strong>Note:</strong> Your VMWare vCenter server should be configured for high availability using the instructions provided by VMWare.</p>

<h2 id="prerequisites">Prerequisites</h2>

<ul><li><a href="../index.html#verifying-your-installation">Verify your cloud installation</a>.</li>
<li>Set up the management port-group in DVS. Make sure  that there is a proper network connection between the overcloud controller and the port-group.</li>
<li>Verify the network connection between the overcloud controller and the proxy.</li>
<li>Ping the gateway of the ESX Network or log in to the server where you will deploy the ESX Compute proxy.</li>
<li>Note the access credentials for vCenter.</li>
<li>Choose a list of clusters to be configured as the Helion Compute resource.</li>
<li>Choose a cluster to deploy the proxy. We recommended you do <strong>not</strong> select the same cluster selected for the compute resource.</li>
<li>Configure the proxy with either a static IP or using DHCP. If you use a static IP, prepare the network information(IP address, netmask and gateway).</li>
</ul><h2 id="create-a-vm-template-in-vcenter">Create a VM Template in vCenter</h2>

<p>The first step in deploying the ESX compute proxy is to create a VM template that will make it easier to deploy the ESX compute proxy on each server.</p>

<h3 id="create-a-new-vm">Create a new VM</h3>

<ol><li><p>Import the <code>overcloud_vcenter_compute_proxy_1.0.1.ova</code> into the vCenter using the vSphere client.</p></li>
<li><p>In the vSphere Client, click <strong>File</strong> and then click <strong>Deploy OVF Template</strong>.</p></li>
<li><p>Follow the instructions in the wizard to specify the data center, cluster, and node to install to. Refer to the VMWare vSphere documentation as needed.</p></li>
<li><p><strong>Important</strong>. You must enter <code>overcloud_vcenter_compute_proxy</code> as the name for the template.</p></li>
</ol><p>A new VM, referred to here as <strong><em>OVF VM</em></strong>, appears in the left pane.</p>

<h3 id="add-a-cd-rom-device-to-the-ovf-vm">Add a CD-ROM device to the OVF VM</h3>

<ol><li><p>In the vSphere Client, right-click the OVF VM.</p></li>
<li><p>Click <strong>Edit Settings</strong>.</p></li>
<li><p>Select the <strong>Hardware</strong> tab and click <strong>Add</strong>.</p></li>
<li><p>Select <strong>DVD/CD-ROM Drive</strong>.</p></li>
<li><p>Follow the instructions in the wizard. Refer to the VMWare vSphere documentation as needed.</p></li>
</ol><h3 id="power-on-the-ovf-vm-using-vcenter">Power on the OVF VM using vCenter.</h3>

<p>The default credentials to log in to the OVF VM are <code>stack/stack</code>.</p>

<ol><li><p>Install the VMWare tools into the OVF VM:</p>

<p>a.In the vSphere Client, right-click the OVF VM.</p>

<p>b. Select <strong>Guest &gt; Install/Upgrade VMware Tools</strong>.</p></li>
<li><p>Launch the OVF VM console to install the VMware Tools from command line terminal:</p>

<p>a. Right-click the OVF VM and select <strong>Open Console</strong>.</p>

<p>b. Enter the following commands:</p>

<pre><code>mkdir /tmp/vmware-tools
sudo mount /dev/cdrom/  /tmp/vmware-tools
cd /tmp
tar xvzf  /tmp/vmware-tools/VMwareTools-*.tar.gz
cd vmware-tools-distrib
sudo ./vmware-tools-install.pl --default
sudo poweroff
</code></pre>

<p>Follow the instructions to continue the installation.</p></li>
</ol><h3 id="remove-the-cd-rom-device-from-the-ovf-vm">Remove the <strong>CD-ROM</strong> device from the OVF VM</h3>

<ol><li><p>In the vSphere Client, right-click the OVF VM.</p></li>
<li><p>Click <strong>Edit Settings</strong>.</p></li>
<li><p>Select the <strong>Remove the CD/DVD drive</strong>.</p></li>
<li><p>Select the <strong>Hardware</strong> tab.</p></li>
<li><p>Remove the DVD/CD-ROM drive. Refer to the VMWare vSphere documentation as needed.</p></li>
</ol><h3 id="convert-the-ovf-vm-into-a-template">Convert the OVF VM into a template</h3>

<ol><li><p>In the vSphere Client, right-click the OVF VM.</p></li>
<li><p>Click <strong>Template</strong>.</p></li>
<li><p>Select <strong>Convert to Template</strong>.</p></li>
</ol><h2 id="deploy-the-proxy">Deploy the proxy</h2>

<p>Use the following steps to instantiate and run a copy of the VM template on each server.</p>

<p>Perform the following steps on the undercloud node using the <a href="#deploy_cli">EON CLI</a> or the <a href="#deploy_ui">Horizon dashboard</a>.</p>

<h3 id="deploy-the-proxy-using-the-undercloud-horizon-dashboard-">Deploy the proxy using the undercloud Horizon dashboard <a name="deploy_ui" id="deploy_ui"></a></h3>

<p>To deploy the ESX compute proxy using the undercloud Horizon dashboard, see the <a href="../../../undercloud/resource/esx.html#register-vcenter">Register vCenter section</a> of the Virtual Environments document.</p>

<h3 id="deploy-the-proxy-using-the-eon-cli-">Deploy the proxy using the EON CLI <a name="deploy_cli" id="deploy_cli"></a></h3>

<p>To deploy the ESX compute proxy using the EON CLI, execute the following steps from the UNDERCLOUD node:</p>

<ol><li><p>Create a <code>compute_proxy.conf</code> file that includes the following:</p>

<pre><code>[vmware]
# Details related to vCenter in which Compute Proxy VM will be created
# 
# Datacenter name
datacenter=
# Management Cluster name
mgmt_cluster=
# Shared datatstore name
datastore=
# SSL certificate file (cacert.pem) of vCenter
cert_location=

[network]

# port group name which will attached to the proxy VM 
# it will be management port group which will connect compute proxy VM
# with your overcontrollers 

port_group_name=

[compute_proxy]
# This section hold the values which will be used to configure proxy VM
# 1) hostname -&gt; should not have '_'    
# 2) Network information of the vm
# if usedhcp = False, provide values for ipaddr, netmask, gateway
# if usedhcp = True, leave empty  ipaddr, netmask, gateway
hostname=
usedhcp=
ipaddr=
netmask=
gateway=
</code></pre>

<p>Where:</p>

<pre><code>datacenter = enter the name of the vCenter Server
mgmt_cluster = enter the name of the vCenter Management Cluster
datastore = enter the name of the shared datastore
cert_location = enter the location of the `compute_proxy.conf` file
port_group_name = enter the name of the management port group
hostname = enter the name of the host name of the compute proxy
usedhcp = enter `true` to use DHCP; enter `false` to specify values
ipaddr = enter the compute proxy IP of the vCenter
netmask = enter the compute proxy netmask
gateway = enter the compute proxy gateway
</code></pre></li>
<li><p>Use the <a href="../../../services/eon/overview/index.html">HP EON servcie CLI</a> to deploy the ESX compute proxy. For details refer to the <a href="../../../undercloud/eon/cli/index.html">EON CLI</a> reference.</p>

<pre><code>source /root/stackrc
eon vcenter-add -name=&lt;VCENTER_NAME&gt; --ip-address=&lt;VCENTER_IP_ADDRESS&gt; --username=&lt;VCENTER_USERNAME&gt; --password=&lt;VCENTER_PASSWORD&gt; --port=&lt;VCENTER_PORT&gt; --proxy-config-file=&lt;COMPUTE PROXY CONFIG FILE&gt;
eon import-cluster --vcenter-id=&lt;VCENTER_ID&gt; --cluster-moid=&lt;CLUSTER_MOID&gt; --cluster-name=&lt;CLUSTER_NAME&gt;
eon activate-clusters &lt;VCENTER_ID&gt; --clusters &lt;CLUSTER_MOIDS&gt; [&lt;CLUSTER_MOIDS&gt; ...] 
</code></pre>

<p>Where:</p>

<pre><code>VCENTER_NAME is the name for the vCenter server where the proxy will deploy 
VCENTER_IP_ADDRESS is the IP address of the vCenter server where the proxy will deploy
VCENTER_USERNAME is the username for the vCenter administrator
VCENTER_PASSWORD is the password for the vCenter administrator
VCENTER_PORT is the vCenter Server Port 
COMPUTE PROXY CONFIG FILE is the complete path to the `compute_proxy.conf` file created in a previous step.
VCENTER_ID is the unique ID of the vCenter server where the proxy will deploy.
CLUSTER_MOID is the Managed Object ID (MOID) of the server where the proxy will deploy (assigned to each cluster by vCenter).
CLUSTER_NAME is the name of the server where the proxy will deploy
VCENTER_ID is the unique ID of the vCenter server where the proxy will deploy
CLUSTER_MOIDS the cluster ID (Managed Object ID). Use the `eon cluster-list -vcenter-id=&lt;VCENTER_ID&gt;` command, if needed, to obtain this value.
</code></pre>

<p>A vCenter proxy VM named <code>hp_helion_vcenter_proxy</code> will be available in the specified vCenter. You can access that proxy VM from the seed VM host as the <code>heat-admin</code> user without password.</p></li>
<li><p>For each additional cluster to be managed, use the following command:</p>

<pre><code>eon activate-clusters &lt;VCENTER_ID&gt; --clusters &lt;CLUSTER_MOIDS&gt; [&lt;CLUSTER_MOIDS&gt; ...]
</code></pre>

<p>The new clusters will be updated in the nova-compute.conf of the VM</p></li>
</ol><p>If you need to delete an ESX Compute proxy, use the following command:</p>

<pre>
  <code>eon deactivate-clusters &lt;VCENTER_ID&gt; --clusters &lt;CLUSTER_MOIDS&gt; [&lt;CLUSTER_MOIDS&gt; ...] 
Proxy VM named hp_helion_vcenter_proxy will be deleted - ( if no clusters is in activated state for the vcenter )
</code>
</pre>

<!-- Hide per Satya
## Enable SSL between vCenter and proxy VM ##

Use the following steps to configure SSL between vCenter and the ESX computer proxy using either the [CLI](#cli) or [vSphere client](#ui).

### Using the command-line<a name="cli"></a>

1. Locate the root certificate from the vCenter server available at this location `C:\ProgramData\VMware\VMware VirtualCenter\SSL\cacert.pem`

2. Copy the certificate to the location specified in the `cert_location` value of the [`compute_proxy.conf`](#undercloud) file. 

2. Copy the certificate into the `/root/hp-vcenter-compute-proxy/input/cacert.pem`

3. Edit the [`compute_proxy.conf`](#undercloud) file to change the host-name of the vCenter (Compulsory) instead of `ip-address` in the `--ip-address=VCENTER_IP_ADDRESS` line.

4. If DNS name resolution is not available add a `/etc/hosts` entry for the vCenter ip address.

### Using the vSphere client<a name="ui"></a>

1. Get the root certificate from the vCenter server available at this location `C:\ProgramData\VMware\VMware VirtualCenter\SSL\cacert.pem`

2. Copy the contents of the certificate file into the text box provided for SSL certificates.

3. Provide the FQDN host-name of the vCenter instead of the ip-address in the **Server Address** field.
-->

<h2 id="next-steps">Next Steps</h2>

<ul><li><p>Deploy the Open vSwitch vApp <strong>(REQUIRED)</strong>.</p>

<p>If you have not deployed the HP Virtual Cloud Networking's Open vSwitch vApp (OVSvApp), see the <a href="../../ovsvapp/index.html">Deploying and configuring OVSvApp for HP Virtual Cloud Networking (VCN) on ESX hosts</a> document for complete instructions.</p>

<p>OVSvApp must be installed for HP Helion OpenStack environment to provision VMs in your VMware vCenter environment. Once deployed, OVSvApp appliance enables networking between the tenant Virtual Machines (VMs).</p></li>
<li><p>Install DNS as a service (DNSaaS) (Optional).</p>

<p>If you have not installed DNSaaS, see <a href="../../dnsaas/index.html">DNSaaS Installation and Configuration</a>.</p>

<p>DNSaaS is HP's managed DNS service based on the OpenStack Designate project. It is engineered to help you create, publish, and manage your DNS zones and records securely and efficiently on either a public or private DNS server network.</p></li>
</ul><p>
  <a href="#top" style="padding:14px 0px 14px 0px; text-decoration: none;"> Return to Top â </a>
</p>

<hr />
	</article>
</div>

<div id="sidebar" class="grid_5 top-spacer">
	<aside class="signup-box">
		<p class="align-center">
			Start using HP Cloud<br>
			<a href="../../../../../../external.html?link=https://helion.hpwsportal.com/#/Home/Show" class="signup-button-orange gutter-top-half">Sign Up Now</a>
		</p>
	</aside>
	<aside class="box section-navigation">
  
     
  
  <ul>
    
      
      
      <li>
        <a class="" href="../../../../../index.html"><span>HP Helion Documentation</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../../index.html"><span>HP Helion OpenStack Documentation Home</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../../release-notes/101/index.html"><span>Release Notes</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../../faq/index.html"><span>FAQ</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../../technical-overview/index.html"><span>Technical Overview</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../../services/overview/index.html"><span>Services Overview</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../../support-matrix/index.html"><span>Support Matrix</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../overview/index.html"><span>Installation Overview</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../security/index.html"><span>Network Security</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../../backup.restore/index.html"><span>Back Up and Restore</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../../services/troubleshooting/index.html"><span>Troubleshooting</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../../related-links/index.html"><span>Related Documentation</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../../glossary/index.html"><span>Glossary</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../../eula/index.html"><span>End User License Agreement</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../../3rd-party-license-agreements/index.html"><span>Open Source and Third-Party Software License Agreements</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../../siteindex/index.html"><span>Site Index</span></a>
      </li>
    
  </ul>
</aside>
</div>

			</div> <!-- #main -->
		</div> <!-- #main-container -->
	</div> <!-- #wrapper -->

		
  <footer class="footer">
    <div class="container_16">
    	<div class="wrapper grid_16">
    		<ul class="footer-social">
    			<li class="twitter"><a href="../../../../../../external.html?link=https://twitter.com/hphelioncloud"></a></li>
    			<li class="youtube"><a href="../../../../../../external.html?link=http://www.youtube.com/hpcloud"></a></li>
    			<li class="rss"><a href="../../../../../../external.html?link=http://h30499.www3.hp.com/hpeb/rss/board?board.id=sws-661"></a></li>
    			<li class="facebook"><a href="../../../../../../external.html?link=https://www.facebook.com/HPCloud"></a></li>
    			<li class="linkedin stretch"><a href="../../../../../../external.html?link=https://www.linkedin.com/company/hewlett-packard"></a></li>
    		</ul>
    		<ul class="contact-info">
    			<li>In the U.S.<br />1-855-61CLOUD</li>
    			<li>Worldwide<br />+1678-745-9010</li>
    			<li class="col-3">Online Support<br /><a href="mailto:support@hpcloud.com">Email</a> 
				<!-- comment out per JC
				or <span class="link" onclick="jQuery('#hpcloud-chat-button a').click();">Chat with us</span>
				-->
				</li>
    		</ul>
    		<div class="copyright">
    			<p>The OpenStack&reg; Word Mark and OpenStack Logo are either registered trademarks/service marks or trademarks/service marks of the OpenStack Foundation, in the United States and other countries and are used with the OpenStack Foundation's permission. We are not affiliated with, endorsed or sponsored by the OpenStack Foundation, or the OpenStack community.</p><br />
    			<p>&copy; 2014 Hewlett-Packard Development Company, L.P.<br /><a href="../../../../../../external.html?link=http://www.hpcloud.com/legal-documents">HP Cloud legal documents and privacy policy</a></p>
    		</div>
    	</div>
    </div>
  </footer>

	<script src="../../../../../../ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <script src="../../../../../../ajax.googleapis.com/ajax/libs/jqueryui/1.10.2/jquery-ui.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../../../../js/jquery-1.8.2f.min.html"><\/script>')</script>

  <script src="../../../../../js/combined.js"></script>
  <script>
      __HP_CHAT_CONF = {};
      __HP_CHAT_CONF.sales = true;
      __HP_CHAT_CONF.support = true;
    </script>
	
    <script> //removed per JC
    //(function($, window) {
    //    $(window).load(function() {
    //    var sNew = document.createElement("script");
    //  sNew.async = true;
    //sNew.src = 'https://a248.e.akamai.net/cdn.hpcloudsvc.com/gcbb18d905d32174e6eb205943b0dea4a/prodae1/chat.js';
    //var s0 = document.getElementsByTagName('script')[0];
    //s0.parentNode.insertBefore(sNew, s0);
    //});
    //})(jQuery, this);
    </script>
    <script>
        //Executes your code when the DOM is ready.  Acts the same as $(document).ready().
        function styleRestCmds() {
            $("h5:contains('GET')").addClass('rest_cmd cmd_get');
            $("h5:contains('POST')").addClass('rest_cmd cmd_post');
            $("h5:contains('FormPOST')").removeClass('rest_cmd cmd_post');
            $("h5:contains('PUT')").addClass('rest_cmd cmd_put');
            $("h5:contains('COPY')").addClass('rest_cmd cmd_copy');
            $("h5:contains('PATCH')").addClass('rest_cmd cmd_patch');
            $("h5:contains('HEAD')").addClass('rest_cmd cmd_head');
            $("h5:contains('DELETE')").addClass('rest_cmd cmd_delete');
        }

        $(function() {
            //Calls the tocify method on your HTML div.
            $("#toc").tocify({
                'selectors': 'h2,h3,h4',
                'showAndHideOnScroll': false,
                'hideEffect': 'slideUp',
                'scrollTo': 55    // Amount of space between top of page and selected content
              }
            );
            // Style the REST commands
            styleRestCmds();
        });
    </script>
</body>

<!-- Mirrored from docs.hpcloud.com/helion/openstack/install/esx/proxy/ by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 20 Feb 2015 14:57:34 GMT -->
</html>

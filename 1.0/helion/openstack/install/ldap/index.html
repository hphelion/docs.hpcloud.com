<!doctype html>
<!--[if lt IE 7]> <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if IE 9]>    <html class="no-js ie9" lang="en"> <![endif]-->
<!--[if gt IE 9]><!--> <html class="no-js" lang="en"> <!--<![endif]-->

<!-- Mirrored from docs.hpcloud.com/helion/openstack/install/ldap/ by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 20 Feb 2015 14:57:51 GMT -->
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

	<title>HP Helion OpenStack: Intergrating LDAP</title>
	
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link rel="shortcut icon" href="../../../../favicon.ico" type="image/vnd.microsoft.icon" />
  <link rel="stylesheet" href="../../../../css/combined.css">

	<script src="../../../../js/modernizr-2.5.3.min.js"></script>
	<script src="../../../../js/metrics.js"></script> 
</head>
<body>
  <div id="wrapper">
    <!--[if lt IE 7]>
    	<p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
    <![endif]-->
    <div class="header-container">
      <header class="header">
      	<div class="top-bar" style="height: 75px;">
		
      		<div class="search-wrapper wrapper container_16">
			
      			<a href="#" class="sales-rep show-320 show-480 hide-768"><span aria-hidden="true" class="icon-icon-sales-rep"></span></a>
      			<nav class="sub-nav" >
				<a href="../../../../index.html" class="logo"  ><img src="../../../../images/HP_Helion_logo_72.png" style="position: absolute;top: 10px;" alt="HP Helion" /></a>
        			<ul>
					
 

         
        				<li><a href="../../../../../external.html?link=http://www8.hp.com/us/en/cloud/helion-portfolio.html">Helion@HP</a></li>
						<li><a href="../../../../../external.html?link=https://h30580.www3.hp.com/">Support</a></li>
        				<li><a href="mailto:heliondocs@hp.com">Contact</a></li>
						
        				 
        			</ul>
      			</nav>
          </div>
      	</div>
		<!-- per JC
      	<div class="nav-wrapper wrapper container_16">
        	<a href="http://www.hpcloud.com/" class="logo"><img src="/images/HP_Helion_logo_72.png" alt="HP Helion" /></a>
      		<nav class="nav hide-320 show-768">
      			<ul>
      				<li><a href="http://hpcloud.com/products-services">Products <span>& Services</span></a></li>
      				<li><a href="http://hpcloud.com/solutions">Cloud <span>Solutions</span></a></li>
      				<li><a href="http://hpcloud.com/why-hp-cloud">Why HP <span>Cloud?</span></a></li>
      				<li><a href="http://hpcloud.com/learning-center">Learning <span>Center</span></a></li>
      				<li><a href="http://hpcloud.com/blog">The <span>Blog</span></a></li>
      				<li><a href="http://hpcloud.com/free-trial">Sign Up <span>Today</span></a></li>
      			</ul>
      		</nav>
      	</div>
		-->
      </header>
    </div>
		<div id="main-container">
			<div id="main" class="wrapper clearfix container_16">
				<div id="content" class="grid_10 suffix_1">
	<article>
		<!--PUBLISHED-->

<script>
<![CDATA[

function PageRefresh {
onLoad="window.refresh"
}

PageRefresh();

]]>
</script><h1 id="hp-helion-openstack-10-integrating-ldap">HP Helion OpenStack® 1.0: Integrating LDAP</h1>

<p>The HP Helion OpenStack Identity service can use Lightweight Directory Access Protocol (LDAP) to integrate your organization's existing directory service and user account management processes. LDAP integration must be performed during the HP Helion OpenStack installation process.</p>

<p>The process for integrating LDAP involves the following steps:</p>

<ul><li><a href="#pre">Verify prerequisites</a></li>
<li><a href="#config">Generate configuration files</a></li>
<li><a href="#install">Include the configuration files in the installation</a></li>
<li><a href="#horizon">Configure Horizon</a></li>
</ul><h2 id="pre">Prerequisites</h2>

<p>Before starting the integration, review the following prerequisites:</p>

<ul><li><p>LDAP server is up and running in a network accessible from the overcloud.</p></li>
<li><p>The following users need to be created on the LDAP server and their passwords must be set in accordance with the current LDAP server policy.</p>

<ul><li>admin</li>
<li>ceilometer</li>
<li>cinder</li>
<li>demo</li>
<li>ec2</li>
<li>glance</li>
<li>heat</li>
<li>neutron</li>
<li>nova</li>
<li>sherpa</li>
<li>swift</li>
</ul></li>
</ul><h2 id="config">Generate configuration files</h2>

<p>The LDAP integration process requires two configuration files:</p>

<ul><li><a href="#tripleo">TripleO overcloud password file</a></li>
<li><a href="#connect">LDAP server connection settings</a></li>
</ul><h3 id="tripleo">TripleO overcloud password file</h3>

<p>This file contains the password for all the service users created on the LDAP server. The password for each user should be the password that was specified when creating the user on the LDAP server.</p>

<p>
  <strong>tripleo-overcloud-passwords file</strong>
</p>

<pre>
  <code>OVERCLOUD_ADMIN_PASSWORD=&lt;password&gt;
OVERCLOUD_CEILOMETER_PASSWORD=&lt;password&gt;
OVERCLOUD_CINDER_PASSWORD=&lt;password&gt;
OVERCLOUD_DEMO_PASSWORD=&lt;password&gt;
OVERCLOUD_EC2_PASSWORD=&lt;password&gt;
OVERCLOUD_GLANCE_PASSWORD=&lt;password&gt;
OVERCLOUD_HEAT_PASSWORD=&lt;password&gt;
OVERCLOUD_NEUTRON_PASSWORD=&lt;password&gt;
OVERCLOUD_NOVA_PASSWORD=&lt;password&gt;
OVERCLOUD_SHERPA_PASSWORD=&lt;password&gt;
OVERCLOUD_SWIFT_PASSWORD=&lt;password&gt;
</code>
</pre>

<p>The file must end with a carriage return. TripleO will add lines to the end of the file so if the carriage return is missing, new content will be added to the end of the last line and will be ignored.</p>

<h3 id="connect">LDAP server connection settings</h3>

<p>This file contains the LDAP server connection settings.  The content of the file will be transparently propagated in <code>/etc/keystone/keystone.conf</code> on each of the overcloud controller nodes. Therefore, it must be a well-formed, syntax-error free json file.</p>

<p>The following options must be set with proper values to provide integration with the LDAP server:</p>

<table style="text-align: left; vertical-align: top; width:650px;">
  <tr style="background-color: lightgrey; color: black;"><td><b> Username </b></td><td><b>Password</b></td><td><b> AD/LDAP Default values </b></td><td><b>OpenLDAP default values</b></td>
    </tr>
  <tr><td>[identity]</td><td> </td><td> </td><td> </td>
    </tr>
  <tr>
    <td>driver</td>
    <td>(StrOpt) Identity backend driver</td>
    <td>keystone.identity.backends.ldap.Identity</td>
    <td>keystone.identity.backends.ldap.Identity
    </td>
  </tr>
  <tr><td>[assignment]</td><td> </td><td> </td><td> </td>
    </tr>
  <tr><td>driver</td><td>(StrOpt) Assignment backend driver</td><td>  keystone.assignment.backends.sql.Assignment</td><td>keystone.assignment.backends.sql.Assignment</td>
    </tr>
  <tr><td>[ldap]</td><td> </td><td> </td><td> </td>
    </tr>
  <tr><td>group_id_attribute</td><td>(StrOpt) LDAP attribute mapped to group id.</td><td>cn</td><td>Cn</td>
    </tr>
  <tr><td>group_name_attribute</td><td>(StrOpt) LDAP attribute mapped to group name.</td><td>cn</td><td>Cn</td>
    </tr>
  <tr><td>group_objectclass</td><td>(StrOpt) LDAP objectclass for groups.</td><td>group</td><td>posixGroup</td>
    </tr>
  <tr><td>group_tree_dn</td><td>(StrOpt) Search base for groups.</td><td>CN=Users,DC=example,DC=com</td><td>ou=groups,dc=hpswlabs,dc=apps,dc=hp,dc=com</td>
    </tr>
  <tr><td>group_allow_create</td><td>(BoolOpt) Allow group creation in LDAP backend.</td><td>False</td><td>False</td>
    </tr>
  <tr><td>group_allow_delete</td><td>(BoolOpt) Allow group deletion in LDAP backend.</td><td>False</td><td>False</td>
    </tr>
  <tr><td>group_allow_update</td><td>(BoolOpt) Allow group update in LDAP backend.</td><td>False</td><td>False</td>
    </tr>
  <tr><td>suffix</td><td>(StrOpt) LDAP server suffix</td><td>DC=example,DC=com</td><td>dc=example,dc=com</td>
    </tr>
  <tr><td>url</td><td>(StrOpt) URL for connecting to the LDAP server.</td><td>ldap://localhost</td><td>ldap://localhost</td>
    </tr>
  <tr><td>user_allow_create</td><td>(BoolOpt) Allow user creation in LDAP backend.</td><td>False</td><td>False</td>
    </tr>
  <tr><td>user_allow_delete</td><td>(BoolOpt) Allow user deletion in LDAP backend.</td><td>False</td><td>False</td>
    </tr>
  <tr><td>user_allow_update</td><td>(BoolOpt) Allow user updates in LDAP backend.</td><td>False</td><td>False</td>
    </tr>
  <tr><td>user_id_attribute</td><td>(StrOpt) LDAP attribute mapped to user id.</td><td>cn</td><td>Cn</td>
    </tr>
  <tr><td>user_name_attribute</td><td>(StrOpt) LDAP attribute mapped to user name.</td><td>cn</td><td>Cn</td>
    </tr>
  <tr><td>user_objectclass</td><td>(StrOpt) LDAP objectclass for users.</td><td>user</td><td>Person</td>
    </tr>
  <tr><td>user_tree_dn</td><td>(StrOpt) Search base for users.</td><td>CN=Users,DC=example,DC=com</td><td>ou=people,dc=example,dc=com</td>
    </tr>
  <tr><td>user</td><td>(StrOpt) User BindDN to query the LDAP server.</td><td>CN=SomeLDAPUser,CN=Users,DC=example,DC=com</td><td>Not Required</td>
    </tr>
  <tr><td>password</td><td>(StrOpt) Password for the BindDN to query the LDAP server.</td><td>password</td><td>Not Required</td>
    </tr>
  <tr><td>use_tls</td><td>(BoolOpt) Enable TLS for communicating with LDAP servers.</td><td>False</td><td>False</td>
    </tr>
  <tr><td>tls_req_cert</td><td>(StrOpt) Valid options for tls_req_cert are demand, never, and allow.</td><td>never</td><td>Never</td>
    </tr>
  <tr><td>use_pool</td><td>(BoolOpt) Enable LDAP connection pooling.</td><td>True</td><td>True</td>
    </tr>
  <tr><td>user_enabled_attribute</td><td>(StrOpt) LDAP attribute mapped to user enabled flag.</td><td>userAccountControl</td><td>Not required</td>
    </tr>
  <tr><td>user_enabled_mask</td><td>(IntOpt) Bitmask integer indicating which bit represents the enabled value.  This is used when the LDAP server represents the variable `enabled` as a bit in an integer rather than as a Boolean.  A value of "0" indicates the mask is not used. When not set to "0", the typical value is "2".  This is typically used when `user_enabled_attribute = userAccountControl`.</td><td>2</td><td>Not required</td>
    </tr>
  <tr><td>user_enabled_default</td><td>(StrOpt) Default value to enable users. This should match an appropriate int value if the LDAP server uses non-boolean (bitmask) values to indicate if a user is enabled or disabled. If this is not set to "True" the typical value is "512". This is typically used when `user_enabled_attribute = userAccountControl`.</td><td>512</td><td>Not required</td>
    </tr>
  <tr><td>user_mail_attribute</td><td>(StrOpt) LDAP attribute mapped to user email.</td><td>userPrincipalName</td><td>Not required</td>
    </tr>
</table><h2 id="install">Include the configuration files in the installation</h2>

<p>You need to copy the configuration files to the seed VM host during the installation, after the seed VM is installed and before launching the installation of the overcloud and undercloud.</p>

<p>On the seed VM host, perform the following:</p>

<ol><li><p>Copy the <code>tripleo-overcloud-passwords</code> file to the <code>/root/tripleo folder</code>:</p>

<pre><code>scp tripleo-overcloud-passwords root@&lt;seed_VM_IP_address&gt;:/root/tripleo/tripleo-overcloud-passwords
</code></pre></li>
<li><p>Copy the <code>overcloud_keystone_ldap.json</code> file to the <code>/root/tripleo/hp_passthrough</code> folder:</p>

<pre><code>scp overcloud_keystone_ldap.json root@&lt;seed_VM_IP_address&gt;:/root/tripleo/hp_passthrough/overcloud_keystone_ldap.json
</code></pre></li>
</ol><p>Follow the steps described in the installation instructions to deploy the overcloud nodes.</p>

<p>
  <a href="../kvm/index.html">HP Helion OpenStack®: Installation and Configuration for KVM Hypervisor</a>
</p>

<p>
  <a href="../esx/index.html">HP Helion OpenStack®: Installation and Configuration for ESX Hypervisor</a>
</p>

<h2 id="horizon">Configure Horizon</h2>

<ol><li><p>Enable LDAP user login.</p>

<p>Before a user can successfully login, the user must be assigned to a project. A user with admin privileges must create one or more projects and associate each user to a project.</p></li>
<li><p>Disable CRUD (Create/Update/Delete) operations on users for a read-only identity backend on all three overcloud controller nodes.</p>

<p>a. Modify the <code>/opt/stack/venvs/openstack/lib/python2.7/site-packages/openstack_dashboard/local_settings.py</code> file to disallow editing of users and groups.</p>

<p>Change</p>

<pre><code>OPENSTACK_KEYSTONE_BACKEND = {
    'name': 'native',
    'can_edit_user': True,
    'can_edit_group': True,
    'can_edit_project': True,
    'can_edit_domain': True,
    'can_edit_role': True
</code></pre>

<p>to</p>

<pre><code>OPENSTACK_KEYSTONE_BACKEND = {
    'name': 'native',
    'can_edit_user': False,
    'can_edit_group': False,
    'can_edit_project': True,
    'can_edit_domain': True,
    'can_edit_role': True
</code></pre>

<p>c. Restart apache.</p>

<pre><code>service apache2 restart
</code></pre></li>
</ol><p>The following is an example of a typical <code>overcloud_keystone_ldap.json</code> configuration file for openLDAP server. Use values appropriate for your environment.</p>

<pre>
  <code>{
    "keystone": {
        "config": [
            {
                "section": "identity",
                "values": [
                    {
                        "option": "driver",
                        "value": "keystone.identity.backends.ldap.Identity"
                    }
                ]
            },
            {
                "section": "assignment",
                "values": [
                    {
                        "option": "driver",
                        "value": "keystone.assignment.backends.sql.Assignment"
                    }
                ]
            },
            {
                "section": "ldap",
                "values": [
                    {
                        "option": "url",
                        "value": "ldap://localhost"
                    },
                    {
                        "option": "suffix",
                        "value": "DC=example,DC=com"
                    },                    
                    {
                        "option": "user_tree_dn",
                        "value": "CN=Users,DC=example,DC=com"
                    },
                    {
                        "option": "user",
                        "value": "CN=SomeLDAPUser,CN=Users,DC=example,DC=com"
                    },
                    {
                        "option": "password",
                        "value": "password"
                    },
                    {
                        "option": "user_objectclass",
                        "value": "user"
                    },
                    {
                        "option": "user_id_attribute",
                        "value": "cn"
                    },
                    {
                        "option": "user_name_attribute",
                        "value": "cn"
                    },                    
                    {
                        "option": "user_allow_create",
                        "value": "False"
                    },
                    {
                        "option": "user_allow_update",
                        "value": "False"
                    },
                    {
                        "option": "user_allow_delete",
                        "value": "False"
                    },                                        
                    {
                        "option": "group_tree_dn",
                        "value": "CN=Users,DC=example,DC=com"
                    },
                    {
                        "option": "group_objectclass",
                        "value": "group"
                    },
                    {
                        "option": "group_id_attribute",
                        "value": "cn"
                    },
                    {
                        "option": "group_name_attribute",
                        "value": "cn"
                    },  
                    {
                        "option": "group_allow_create",
                        "value": "False"
                    },
                    {
                        "option": "group_allow_delete",
                        "value": "False"
                    },
                    {
                        "option": "group_allow_update",
                        "value": "False"
                    },                  
                    {
                        "option": "use_tls",
                        "value": "False"
                    },
                    {
                        "option": "tls_req_cert",
                        "value": "never"
                    },
                    {
                        "option": "user_enabled_attribute",
                        "value": "userAccountControl"
                    },
                    {
                        "option": "user_enabled_mask",
                        "value": "2"
                    },
                    {
                        "option": "user_enabled_default",
                        "value": "512"
                    },
                    {
                        "option": "user_mail_attribute",
                        "value": "userPrincipalName"
                    }
                ]
            }
        ]
    }
}
</code>
</pre>

<p>Return to the <a href="../kvm/index.html#startseed/">KVM installation</a>.</p>

<p>Return to the <a href="../esx/index.html#startseed/">ESX installation</a>.</p>

<hr />
	</article>
</div>

<div id="sidebar" class="grid_5 top-spacer">
	<aside class="signup-box">
		<p class="align-center">
			Start using HP Cloud<br>
			<a href="../../../../../external.html?link=https://helion.hpwsportal.com/#/Home/Show" class="signup-button-orange gutter-top-half">Sign Up Now</a>
		</p>
	</aside>
	<aside class="box section-navigation">
  
     
  
  <ul>
    
      
      
      <li>
        <a class="" href="../../../../index.html"><span>HP Helion Documentation</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../index.html"><span>HP Helion OpenStack Documentation Home</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../release-notes/101/index.html"><span>Release Notes</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../faq/index.html"><span>FAQ</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../technical-overview/index.html"><span>Technical Overview</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../services/overview/index.html"><span>Services Overview</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../support-matrix/index.html"><span>Support Matrix</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../overview/index.html"><span>Installation Overview</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../security/index.html"><span>Network Security</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../backup.restore/index.html"><span>Back Up and Restore</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../services/troubleshooting/index.html"><span>Troubleshooting</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../related-links/index.html"><span>Related Documentation</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../glossary/index.html"><span>Glossary</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../eula/index.html"><span>End User License Agreement</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../3rd-party-license-agreements/index.html"><span>Open Source and Third-Party Software License Agreements</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../siteindex/index.html"><span>Site Index</span></a>
      </li>
    
  </ul>
</aside>
</div>

			</div> <!-- #main -->
		</div> <!-- #main-container -->
	</div> <!-- #wrapper -->

		
  <footer class="footer">
    <div class="container_16">
    	<div class="wrapper grid_16">
    		<ul class="footer-social">
    			<li class="twitter"><a href="../../../../../external.html?link=https://twitter.com/hphelioncloud"></a></li>
    			<li class="youtube"><a href="../../../../../external.html?link=http://www.youtube.com/hpcloud"></a></li>
    			<li class="rss"><a href="../../../../../external.html?link=http://h30499.www3.hp.com/hpeb/rss/board?board.id=sws-661"></a></li>
    			<li class="facebook"><a href="../../../../../external.html?link=https://www.facebook.com/HPCloud"></a></li>
    			<li class="linkedin stretch"><a href="../../../../../external.html?link=https://www.linkedin.com/company/hewlett-packard"></a></li>
    		</ul>
    		<ul class="contact-info">
    			<li>In the U.S.<br />1-855-61CLOUD</li>
    			<li>Worldwide<br />+1678-745-9010</li>
    			<li class="col-3">Online Support<br /><a href="mailto:support@hpcloud.com">Email</a> 
				<!-- comment out per JC
				or <span class="link" onclick="jQuery('#hpcloud-chat-button a').click();">Chat with us</span>
				-->
				</li>
    		</ul>
    		<div class="copyright">
    			<p>The OpenStack&reg; Word Mark and OpenStack Logo are either registered trademarks/service marks or trademarks/service marks of the OpenStack Foundation, in the United States and other countries and are used with the OpenStack Foundation's permission. We are not affiliated with, endorsed or sponsored by the OpenStack Foundation, or the OpenStack community.</p><br />
    			<p>&copy; 2014 Hewlett-Packard Development Company, L.P.<br /><a href="../../../../../external.html?link=http://www.hpcloud.com/legal-documents">HP Cloud legal documents and privacy policy</a></p>
    		</div>
    	</div>
    </div>
  </footer>

	<script src="../../../../../ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <script src="../../../../../ajax.googleapis.com/ajax/libs/jqueryui/1.10.2/jquery-ui.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../../../js/jquery-1.8.2f.min.html"><\/script>')</script>

  <script src="../../../../js/combined.js"></script>
  <script>
      __HP_CHAT_CONF = {};
      __HP_CHAT_CONF.sales = true;
      __HP_CHAT_CONF.support = true;
    </script>
	
    <script> //removed per JC
    //(function($, window) {
    //    $(window).load(function() {
    //    var sNew = document.createElement("script");
    //  sNew.async = true;
    //sNew.src = 'https://a248.e.akamai.net/cdn.hpcloudsvc.com/gcbb18d905d32174e6eb205943b0dea4a/prodae1/chat.js';
    //var s0 = document.getElementsByTagName('script')[0];
    //s0.parentNode.insertBefore(sNew, s0);
    //});
    //})(jQuery, this);
    </script>
    <script>
        //Executes your code when the DOM is ready.  Acts the same as $(document).ready().
        function styleRestCmds() {
            $("h5:contains('GET')").addClass('rest_cmd cmd_get');
            $("h5:contains('POST')").addClass('rest_cmd cmd_post');
            $("h5:contains('FormPOST')").removeClass('rest_cmd cmd_post');
            $("h5:contains('PUT')").addClass('rest_cmd cmd_put');
            $("h5:contains('COPY')").addClass('rest_cmd cmd_copy');
            $("h5:contains('PATCH')").addClass('rest_cmd cmd_patch');
            $("h5:contains('HEAD')").addClass('rest_cmd cmd_head');
            $("h5:contains('DELETE')").addClass('rest_cmd cmd_delete');
        }

        $(function() {
            //Calls the tocify method on your HTML div.
            $("#toc").tocify({
                'selectors': 'h2,h3,h4',
                'showAndHideOnScroll': false,
                'hideEffect': 'slideUp',
                'scrollTo': 55    // Amount of space between top of page and selected content
              }
            );
            // Style the REST commands
            styleRestCmds();
        });
    </script>
</body>

<!-- Mirrored from docs.hpcloud.com/helion/openstack/install/ldap/ by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 20 Feb 2015 14:57:51 GMT -->
</html>

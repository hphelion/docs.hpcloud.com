<!doctype html>
<!--[if lt IE 7]> <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if IE 9]>    <html class="no-js ie9" lang="en"> <![endif]-->
<!--[if gt IE 9]><!--> <html class="no-js" lang="en"> <!--<![endif]-->

<!-- Mirrored from docs.hpcloud.com/als/v1/admin/cluster/autoscaling/ by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 20 Feb 2015 14:59:55 GMT -->
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

	<title>DEA Auto Scaling</title>
	
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link rel="shortcut icon" href="../../../../../favicon.ico" type="image/vnd.microsoft.icon" />
  <link rel="stylesheet" href="../../../../../css/combined.css">

	<script src="../../../../../js/modernizr-2.5.3.min.js"></script>
	<script src="../../../../../js/metrics.js"></script> 
</head>
<body>
  <div id="wrapper">
    <!--[if lt IE 7]>
    	<p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
    <![endif]-->
    <div class="header-container">
      <header class="header">
      	<div class="top-bar" style="height: 75px;">
		
      		<div class="search-wrapper wrapper container_16">
			
      			<a href="#" class="sales-rep show-320 show-480 hide-768"><span aria-hidden="true" class="icon-icon-sales-rep"></span></a>
      			<nav class="sub-nav" >
				<a href="../../../../../index.html" class="logo"  ><img src="../../../../../images/HP_Helion_logo_72.png" style="position: absolute;top: 10px;" alt="HP Helion" /></a>
        			<ul>
					
 

         
        				<li><a href="../../../../../../external.html?link=http://www8.hp.com/us/en/cloud/helion-portfolio.html">Helion@HP</a></li>
						<li><a href="../../../../../../external.html?link=https://h30580.www3.hp.com/">Support</a></li>
        				<li><a href="mailto:heliondocs@hp.com">Contact</a></li>
						
        				 
        			</ul>
      			</nav>
          </div>
      	</div>
		<!-- per JC
      	<div class="nav-wrapper wrapper container_16">
        	<a href="http://www.hpcloud.com/" class="logo"><img src="/images/HP_Helion_logo_72.png" alt="HP Helion" /></a>
      		<nav class="nav hide-320 show-768">
      			<ul>
      				<li><a href="http://hpcloud.com/products-services">Products <span>& Services</span></a></li>
      				<li><a href="http://hpcloud.com/solutions">Cloud <span>Solutions</span></a></li>
      				<li><a href="http://hpcloud.com/why-hp-cloud">Why HP <span>Cloud?</span></a></li>
      				<li><a href="http://hpcloud.com/learning-center">Learning <span>Center</span></a></li>
      				<li><a href="http://hpcloud.com/blog">The <span>Blog</span></a></li>
      				<li><a href="http://hpcloud.com/free-trial">Sign Up <span>Today</span></a></li>
      			</ul>
      		</nav>
      	</div>
		-->
      </header>
    </div>
		<div id="main-container">
			<div id="main" class="wrapper clearfix container_16">
				<div id="content" class="grid_10 suffix_1">
	<article>
		<!--PUBLISHED-->

<h1 id="dea-auto-scaling">HP Helion Development Platform: DEA Auto Scaling</h1>

<ul><li><a href="#dea-template">DEA Template</a></li>
<li><a href="#dea-scaling-configuration">DEA Scaling configuration</a></li>
<li><a href="#enabling-auto-scaling">Enabling Auto-Scaling</a></li>
<li><a href="#configuration-and-tuning-advanced">Configuration and Tuning (Advanced)</a></li>
<li><a href="#writing-custom-scaling-plugins-advanced">Writing custom scaling plugins (Advanced)</a></li>
<li><a href="#troubleshooting">Troubleshooting</a></li>
<li><a href="#testing">Testing</a></li>
</ul><p>Application Lifecycle Service can automatically add DEA nodes to a cluster to handle
increasing numbers of user application instances.</p>

<p>When auto scaling is enabled, the Application Lifecycle Service will automatically grow the pool of DEA nodes to accommodate new app deployments. Scaling events are triggered when the available memory in the pool falls below a certain threshold.</p>

<h2 id="dea-template">DEA Template</h2>

<p>Before enabling auto scaling, you will need to create a DEA template
from the standard Application Lifecycle Service VM. Typically you would do this by running the following commands on a fresh Application Lifecycle Service VM:</p>

<pre>
  <code>kato op defer "node attach -e dea CORE_IP" --run-as-root
</code>
</pre>

<p>This defers the <code>attach</code> command and enables the DEA
role on the next boot. Shut down the VM once this is done.</p>

<h2 id="dea-scaling-configuration">DEA Scaling configuration</h2>

<p>The DEA auto scaling configuration file is:</p>

<pre>
  <code>/s/etc/autoscaling/autoscaling.yaml
</code>
</pre>

<p>This file must be modified on each node running the Controller role.</p>

<p>Comments throughout the file describe in detail what each option does,
and what information is required for each infrastructure platform.</p>

<p>The <code>enabled_plugins</code> key must be set to OpenStack.</p>

<p>Each platform has specific tunable settings under the <code>platform</code> key in <em>autoscaling.yaml</em> for setting authorization credentials, DEA template IDs and so forth. Configure the settings for your platform in this file before proceeding.</p>

<p>It is possible to enable multiple plugins, but this is generally <strong>not</strong> recommended. You could use this feature to implement a "ping" plugin that doesn't provision a DEA, but sends a notification email instead or pings a remote API.</p>

<h2 id="enabling-auto-scaling">Enabling Auto-Scaling<a href="#enabling-auto-scaling" title="Permalink to this headline"></a></h2>

<p>Run the following command on the Primary node:</p>

<pre>
  <code>kato config set cloud_controller_ng autoscaling/enabled true
kato config set health_manager autoscaling/enabled true
</code>
</pre>

<p>
  <strong>Note</strong>
</p>

<p>If you are running more than one cloud controller in your cluster,
enable the scaling plugin on <strong>only one</strong> of the cloud controllers,
otherwise each one will provision a separate DEA on every scaling event.</p>

<p>After saving this change, restart the following processes:</p>

<pre>
  <code>kato process restart health_manager cloud_controller_ng
</code>
</pre>

<p>You should then start seeing some scaling information in the Health
Manager's log file:</p>

<pre>
  <code>kato log tail health_manager
</code>
</pre>

<h2 id="configuration-and-tuning-advanced">Configuration and Tuning (Advanced)</h2>

<p>A number of configuration options in the autoscaling file can be customized to fit your particular requirements.</p>

<p>The options in <em>/s/etc/autoscaling/autoscaling.yaml</em> are:</p>

<ul><li><code>scale_op_timeout</code>

<ul><li>Specifies how long the scaler will wait for the plugin to complete a scale up operation (Default: 300, Unit: seconds).</li>
</ul></li>
<li><code>cooldown_period</code>

<ul><li>After a scaling event, ignore subsequent scaling requests until this period expires. Prevents duplicate scaling events. (Default: 120, Unit: seconds)</li>
</ul></li>
<li><code>vm_name_prefix</code>

<ul><li>Gives the new Application Lifecycle Service VM instance a name with this prefix to easily</li>
</ul></li>
<li>identify autoscaled instances.</li>
</ul><p>Further settings are found in the health_manager configuration (see <code>kato config get health_manager autoscaling</code>)</p>

<ul><li><code>scaleup_threshold</code>

<ul><li>Number of cycles to wait before issuing a scaling request. The health manager monitors the DEA pool continually. If the forward buffer is not maintained during the number of cycles indicated by this value, the scaling event will be sent to the cloud controller. Decrease this value to make autoscaling more aggressive. (Default: 3)</li>
</ul></li>
<li><code>forward_buffer</code>

<ul><li>The number of megabytes of free memory to maintain in the DEA pool. Note that app memory usage on each DEA is also accounted for. (Default: 4096, Unit: MB)</li>
</ul></li>
<li><code>cooldown_period</code>

<ul><li>After a scaling event, ignore subsequent scaling requests until this period expires (Default: 180, Unit: seconds)</li>
</ul></li>
<li><code>dea_staleness</code>

<ul><li>Maximum time to wait for DEAs to report their status via NATS. If a DEA fails to report in during this period (e.g. it becomes unresponsive) it will be removed from the pool, which may lead to a new scaling event being triggered. (Default: 180, Unit: seconds)</li>
</ul></li>
</ul><h2 id="writing-custom-scaling-plugins-advanced">Writing custom scaling plugins (Advanced)</h2>

<p>Autoscaling plugins are written in Ruby. You can see the built-in
plugins in the <em>/s/etc/autoscaling/plugins/</em> directory. A simpler
"skeleton" plugin might look like this:</p>

<pre>
  <code>require 'rubygems'

class SkeletonPlugin &lt; Plugin

  def platform_name
    "Skeleton"
  end

  def scale_up
    log "Scaling up..."
    log platform_config.inspect
  end

  def handle_command
    log "Handling command: #{cmd}"
  end

end
</code>
</pre>

<p>The <code>log</code> function is available to all plugins and
operates at the cloud controllers global log level.</p>

<p>Once you have written a plugin, install the file in
<em>/s/etc/autoscaling/plugins/</em>. Add configuration for the plugin in
<em>/s/etc/autoscaling/autoscaling.yaml</em> under the
<code>platform_config</code> key in a new section corresponding
to the plugin name (in this case above: <code>skeleton</code>).
Enable the plugin by adding it to the <code>enabled_plugins</code> list.</p>

<h2 id="troubleshooting">Troubleshooting</h2>

<p>Most of the output from the scaling triggers comes from the health
manager:</p>

<pre>
  <code>kato log tail health_manager
</code>
</pre>

<p>Once scaling has been triggered by the health manager, you can check for
the relevant platform API output in the controller:</p>

<pre>
  <code>kato log tail cloud_controller
</code>
</pre>

<h2 id="testing">Testing</h2>

<p>If you want to emulate a scaling trigger, you can force a scale-up operation by issuing the following on the cloud controller node:</p>

<pre>
  <code>nats-pub health.scale '{"op": "up"}'
</code>
</pre>
	</article>
</div>

<div id="sidebar" class="grid_5 top-spacer">
	<aside class="signup-box">
		<p class="align-center">
			Download the<br>Development Platform<br>
			<a href="../../../../../../external.html?link=https://helion.hpwsportal.com/#/Home/Show">DOWNLOAD NOW</a>
		</p>
	</aside>
	
 
	<aside class="signup-box">
		<p class="align-center">
			Take the Helion Development Platform for a Free Spin<br>
			<a href="../../../../../helion/devplatform/ALS-developer-trial-quick-start/index.html">Quick Start Developer Trial</a>
		</p>
	</aside>
<!--	
	<aside class="signup-box">
		<p class="align-center">Make sure to check out our Developer Portal
			<a href="https://dev.hpcloud.com">dev.hpcloud.com
</a><br>
 
		</p>
	</aside>
-->	
	<aside class="box section-navigation">
  
     
  
  <ul>
    
      
      
      <li>
        <a class="" href="../../../../../index.html"><span>HP Helion Documentation</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../../../../helion/devplatform/index.html"><span>HP Helion Development Platform Documentation Home</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../../../../helion/devplatform/install/index.html"><span>Development Platform Installation & Configuration</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../../../../helion/devplatform/install/community/index.html"><span>Development Platform Community Edition Installation & Configuration</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../../../../helion/openstack/update/devplat/101/index.html"><span>Development Platform Commercial 1.0.1 Update</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../../../../helion/devplatform/appdev/index.html"><span>Application Developer Resources</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../../../../helion/devplatform/sysadmin/index.html"><span>IT Ops Resources</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../../../../helion/devplatform/appdev/index.html#sample"><span>Sample Code</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../../../../helion/devplatform/release-notes/index.html"><span>Release Notes</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../../../../helion/devplatform/related-topics/index.html"><span>Related Documentation</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../../../../helion/devplatform/deploy/index.html"><span>Application Lifecycle Service Configuration and Deployment</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../index.html"><span>ALS Admin Guide</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../../../../helion/devplatform/eula/index.html"><span>End User License Agreement</span></a>
      </li>
    
      
      
      <li>
        <a class="" href="../../../../../helion/devplatform/3rd-party-license-agreements/index.html"><span>Open Source and Third-Party Software License Agreements</span></a>
      </li>
    
  </ul>
</aside>
</div>

			</div> <!-- #main -->
		</div> <!-- #main-container -->
	</div> <!-- #wrapper -->

		
  <footer class="footer">
    <div class="container_16">
    	<div class="wrapper grid_16">
    		<ul class="footer-social">
    			<li class="twitter"><a href="../../../../../../external.html?link=https://twitter.com/hphelioncloud"></a></li>
    			<li class="youtube"><a href="../../../../../../external.html?link=http://www.youtube.com/hpcloud"></a></li>
    			<li class="rss"><a href="../../../../../../external.html?link=http://h30499.www3.hp.com/hpeb/rss/board?board.id=sws-661"></a></li>
    			<li class="facebook"><a href="../../../../../../external.html?link=https://www.facebook.com/HPCloud"></a></li>
    			<li class="linkedin stretch"><a href="../../../../../../external.html?link=https://www.linkedin.com/company/hewlett-packard"></a></li>
    		</ul>
    		<ul class="contact-info">
    			<li>In the U.S.<br />1-855-61CLOUD</li>
    			<li>Worldwide<br />+1678-745-9010</li>
    			<li class="col-3">Online Support<br /><a href="mailto:support@hpcloud.com">Email</a> 
				<!-- comment out per JC
				or <span class="link" onclick="jQuery('#hpcloud-chat-button a').click();">Chat with us</span>
				-->
				</li>
    		</ul>
    		<div class="copyright">
    			<p>The OpenStack&reg; Word Mark and OpenStack Logo are either registered trademarks/service marks or trademarks/service marks of the OpenStack Foundation, in the United States and other countries and are used with the OpenStack Foundation's permission. We are not affiliated with, endorsed or sponsored by the OpenStack Foundation, or the OpenStack community.</p><br />
    			<p>&copy; 2014 Hewlett-Packard Development Company, L.P.<br /><a href="../../../../../../external.html?link=http://www.hpcloud.com/legal-documents">HP Cloud legal documents and privacy policy</a></p>
    		</div>
    	</div>
    </div>
  </footer>

	<script src="../../../../../../ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <script src="../../../../../../ajax.googleapis.com/ajax/libs/jqueryui/1.10.2/jquery-ui.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../../../../js/jquery-1.8.2f.min.html"><\/script>')</script>

  <script src="../../../../../js/combined.js"></script>
  <script>
      __HP_CHAT_CONF = {};
      __HP_CHAT_CONF.sales = true;
      __HP_CHAT_CONF.support = true;
    </script>
	
    <script> //removed per JC
    //(function($, window) {
    //    $(window).load(function() {
    //    var sNew = document.createElement("script");
    //  sNew.async = true;
    //sNew.src = 'https://a248.e.akamai.net/cdn.hpcloudsvc.com/gcbb18d905d32174e6eb205943b0dea4a/prodae1/chat.js';
    //var s0 = document.getElementsByTagName('script')[0];
    //s0.parentNode.insertBefore(sNew, s0);
    //});
    //})(jQuery, this);
    </script>
    <script>
        //Executes your code when the DOM is ready.  Acts the same as $(document).ready().
        function styleRestCmds() {
            $("h5:contains('GET')").addClass('rest_cmd cmd_get');
            $("h5:contains('POST')").addClass('rest_cmd cmd_post');
            $("h5:contains('FormPOST')").removeClass('rest_cmd cmd_post');
            $("h5:contains('PUT')").addClass('rest_cmd cmd_put');
            $("h5:contains('COPY')").addClass('rest_cmd cmd_copy');
            $("h5:contains('PATCH')").addClass('rest_cmd cmd_patch');
            $("h5:contains('HEAD')").addClass('rest_cmd cmd_head');
            $("h5:contains('DELETE')").addClass('rest_cmd cmd_delete');
        }

        $(function() {
            //Calls the tocify method on your HTML div.
            $("#toc").tocify({
                'selectors': 'h2,h3,h4',
                'showAndHideOnScroll': false,
                'hideEffect': 'slideUp',
                'scrollTo': 55    // Amount of space between top of page and selected content
              }
            );
            // Style the REST commands
            styleRestCmds();
        });
    </script>
</body>

<!-- Mirrored from docs.hpcloud.com/als/v1/admin/cluster/autoscaling/ by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 20 Feb 2015 14:59:55 GMT -->
</html>
